<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Météo Market 🪙</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#94a3b8;--up:#22c55e;--down:#ef4444;--accent:#38bdf8}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui; background:#0f172a;color:var(--text)}
    header{max-width:1000px;margin:20px auto;padding:0 16px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:24px} .badge{color:var(--muted);font-size:13px}
    table{border-collapse:collapse;width:100%;max-width:1000px;margin:10px auto;background:var(--card);border:1px solid #1f2937;border-radius:12px;overflow:hidden}
    th,td{padding:10px 12px;text-align:left} th{cursor:pointer;color:var(--accent);user-select:none;background:#0b1223;position:sticky;top:0}
    tr:nth-child(even){background:#0f1626}
    .up{color:var(--up)} .down{color:var(--down)}
    .flag{font-size:18px;margin-right:6px}
    footer{max-width:1000px;margin:24px auto;padding:0 16px;color:var(--muted);font-size:13px}
    .right{text-align:right}
    .loading{max-width:1000px;margin:20px auto;padding:12px 16px;color:var(--muted)}
    .pill{display:inline-block;border:1px solid #243042;border-radius:999px;padding:4px 8px;font-size:12px;color:var(--muted);margin-left:8px}
  </style>
</head>
<body>
  <header>
    <h1>🪙 Météo Market <span class="pill">gratuit · GitHub Pages</span></h1>
    <div class="badge" id="status">Chargement…</div>
  </header>

  <table id="tbl" hidden>
    <thead>
      <tr>
        <th onclick="setSort('name')">Coin (Pays)</th>
        <th onclick="setSort('price')" class="right">Cours (°C)</th>
        <th onclick="setSort('change')" class="right">Variation 24h</th>
        <th onclick="setSort('cap')" class="right">Cap météo</th>
      </tr>
    </thead>
    <tbody id="body"></tbody>
  </table>

  <div class="loading" id="loading">Fetching les ticks météo…</div>

  <footer>
    Source : <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo</a> (pas de clé, gratuit).  
    “Cours” = température actuelle. “Variation 24h” = différence vs hier, même heure.  
    “Cap météo” = temp × (1 + vent/100) — un score fun pour trier.
  </footer>

<script>
/** --- Configuration des “coins” (capitale par pays) --- */
const COINS = [
  { country:"France",       city:"Paris",      flag:"🇫🇷", lat:48.8566, lon:  2.3522 },
  { country:"Royaume-Uni",  city:"Londres",    flag:"🇬🇧", lat:51.5074, lon: -0.1278 },
  { country:"Allemagne",    city:"Berlin",     flag:"🇩🇪", lat:52.5200, lon: 13.4050 },
  { country:"Espagne",      city:"Madrid",     flag:"🇪🇸", lat:40.4168, lon: -3.7038 },
  { country:"Italie",       city:"Rome",       flag:"🇮🇹", lat:41.9028, lon: 12.4964 },
  { country:"États-Unis",   city:"New York",   flag:"🇺🇸", lat:40.7128, lon:-74.0060 },
  { country:"Japon",        city:"Tokyo",      flag:"🇯🇵", lat:35.6762, lon:139.6503 },
  { country:"Australie",    city:"Sydney",     flag:"
